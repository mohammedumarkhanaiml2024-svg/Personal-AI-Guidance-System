<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overview - Personal AI Guidance System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/shared.css">
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="dark-gradient min-h-screen text-white overflow-x-hidden" x-data="overviewApp()" x-init="init()">
    
    <!-- Main Container -->
    <div class="relative z-10 max-w-7xl mx-auto px-4 py-8">
        
        <!-- Header -->
        <div id="header"></div>
        
        <!-- Navigation -->
        <div id="navigation"></div>
        
        <!-- Overview Content -->
        <div class="space-y-6 animate-fade-in">
            
            <!-- Welcome Section -->
            <div class="text-center mb-8">
                <h1 class="text-5xl font-black gradient-text neon-glow mb-4">
                    üìä Dashboard Overview
                </h1>
                <p class="text-xl text-gray-400">
                    Your complete health and productivity insights at a glance
                </p>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="glow-card rounded-2xl p-6 text-center hover-lift">
                    <div class="text-4xl font-black text-purple-400" x-text="stats.avgSleep + 'h'"></div>
                    <div class="text-gray-400 font-bold mt-2">Avg Sleep</div>
                </div>
                <div class="glow-card rounded-2xl p-6 text-center hover-lift">
                    <div class="text-4xl font-black text-blue-400" x-text="stats.avgExercise + 'm'"></div>
                    <div class="text-gray-400 font-bold mt-2">Avg Exercise</div>
                </div>
                <div class="glow-card rounded-2xl p-6 text-center hover-lift">
                    <div class="text-4xl font-black text-green-400" x-text="stats.taskCompletion + '%'"></div>
                    <div class="text-gray-400 font-bold mt-2">Task Completion</div>
                </div>
                <div class="glow-card rounded-2xl p-6 text-center hover-lift">
                    <div class="text-4xl font-black text-pink-400" x-text="stats.avgMood + '/10'"></div>
                    <div class="text-gray-400 font-bold mt-2">Avg Mood</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Sleep & Exercise Chart -->
                <div class="glow-card rounded-3xl p-8 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-600/10 to-pink-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-black gradient-text">üò¥ Sleep & Exercise</h3>
                            <div class="px-4 py-2 bg-purple-900/50 rounded-full text-purple-400 text-sm font-bold">
                                Last 30 Days
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-2xl p-4 border border-purple-900/30">
                            <canvas id="sleepExerciseChart" class="w-full h-64"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Productivity Chart -->
                <div class="glow-card rounded-3xl p-8 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-600/10 to-cyan-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-black gradient-text">üìä Productivity</h3>
                            <div class="px-4 py-2 bg-blue-900/50 rounded-full text-blue-400 text-sm font-bold">
                                Tasks Flow
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-2xl p-4 border border-blue-900/30">
                            <canvas id="productivityChart" class="w-full h-64"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Mood Chart -->
                <div class="glow-card rounded-3xl p-8 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-600/10 to-rose-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-black gradient-text">üòä Mood Trends</h3>
                            <div class="px-4 py-2 bg-pink-900/50 rounded-full text-pink-400 text-sm font-bold">
                                Emotional State
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-2xl p-4 border border-pink-900/30">
                            <canvas id="moodChart" class="w-full h-64"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Habits Chart -->
                <div class="glow-card rounded-3xl p-8 relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-green-600/10 to-emerald-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-black gradient-text">üìö Habits</h3>
                            <div class="px-4 py-2 bg-green-900/50 rounded-full text-green-400 text-sm font-bold">
                                Distribution
                            </div>
                        </div>
                        <div class="bg-black/30 rounded-2xl p-4 border border-green-900/30">
                            <canvas id="habitsChart" class="w-full h-64"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <a href="/track.html" class="glow-card rounded-2xl p-6 text-center hover-scale transition-all group">
                    <div class="text-5xl mb-4 group-hover:animate-bounce">üìù</div>
                    <h3 class="text-xl font-bold gradient-text mb-2">Track Today</h3>
                    <p class="text-gray-400">Log your habits, mood, and productivity</p>
                </a>
                
                <a href="/analytics.html" class="glow-card rounded-2xl p-6 text-center hover-scale transition-all group">
                    <div class="text-5xl mb-4 group-hover:animate-bounce">üìà</div>
                    <h3 class="text-xl font-bold gradient-text mb-2">View Analytics</h3>
                    <p class="text-gray-400">Detailed insights and statistics</p>
                </a>
                
                <a href="/brain.html" class="glow-card rounded-2xl p-6 text-center hover-scale transition-all group">
                    <div class="text-5xl mb-4 group-hover:animate-bounce">üß†</div>
                    <h3 class="text-xl font-bold gradient-text mb-2">AI Brain</h3>
                    <p class="text-gray-400">See what your AI has learned</p>
                </a>
                
                <a href="/chat.html" class="glow-card rounded-2xl p-6 text-center hover-scale transition-all group">
                    <div class="text-5xl mb-4 group-hover:animate-bounce">üí¨</div>
                    <h3 class="text-xl font-bold gradient-text mb-2">Chat with AI</h3>
                    <p class="text-gray-400">Get personalized advice</p>
                </a>
            </div>
        </div>
    </div>

    <script src="/shared.js"></script>
    <script>
        function overviewApp() {
            return {
                stats: {
                    avgSleep: '--',
                    avgExercise: '--',
                    taskCompletion: '--',
                    avgMood: '--'
                },
                charts: {},
                
                async init() {
                    if (!requireAuth()) return;
                    
                    document.getElementById('header').innerHTML = createHeader(aiApp.currentUser);
                    document.getElementById('navigation').innerHTML = createNavigation('overview');
                    
                    await this.loadDashboard();
                    await this.loadCharts();
                },
                
                async loadDashboard() {
                    try {
                        const data = await aiApp.loadChartData();
                        const { habits, productivity, mood } = data;
                        
                        // Calculate stats
                        this.stats.avgSleep = habits.length > 0 
                            ? aiApp.formatNumber(aiApp.calculateAverage(habits, 'sleep_hours')) 
                            : '0';
                        
                        this.stats.avgExercise = habits.length > 0 
                            ? Math.round(aiApp.calculateAverage(habits, 'exercise_minutes')) 
                            : '0';
                        
                        const totalPlanned = aiApp.calculateTotal(productivity, 'tasks_planned');
                        const totalCompleted = aiApp.calculateTotal(productivity, 'tasks_completed');
                        this.stats.taskCompletion = totalPlanned > 0 
                            ? Math.round((totalCompleted / totalPlanned) * 100) 
                            : '0';
                        
                        this.stats.avgMood = mood.length > 0 
                            ? aiApp.formatNumber(aiApp.calculateAverage(mood, 'happiness_level')) 
                            : '0';
                        
                    } catch (error) {
                        console.error('Error loading dashboard:', error);
                    }
                },
                
                async loadCharts() {
                    try {
                        const data = await aiApp.loadChartData();
                        aiApp.setupChartDefaults();
                        this.createCharts(data);
                    } catch (error) {
                        console.error('Error loading charts:', error);
                    }
                },
                
                createCharts(data) {
                    const { habits, productivity, mood } = data;
                    
                    // Sleep & Exercise Chart
                    if (this.charts.sleepExercise) this.charts.sleepExercise.destroy();
                    this.charts.sleepExercise = new Chart(document.getElementById('sleepExerciseChart'), {
                        type: 'line',
                        data: {
                            labels: habits.map(h => aiApp.formatDate(h.date)).reverse().slice(-7),
                            datasets: [
                                {
                                    label: 'üò¥ Sleep Hours',
                                    data: habits.map(h => h.sleep_hours).reverse().slice(-7),
                                    borderColor: '#8b5cf6',
                                    backgroundColor: 'rgba(139, 92, 246, 0.2)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: 'üèÉ Exercise (min)',
                                    data: habits.map(h => h.exercise_minutes).reverse().slice(-7),
                                    borderColor: '#ec4899',
                                    backgroundColor: 'rgba(236, 72, 153, 0.2)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    labels: { color: '#fff', font: { size: 12, weight: 'bold' } }
                                }
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Hours', color: '#8b5cf6' },
                                    grid: { color: 'rgba(139, 92, 246, 0.1)' },
                                    ticks: { color: '#8b5cf6' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Minutes', color: '#ec4899' },
                                    grid: { drawOnChartArea: false },
                                    ticks: { color: '#ec4899' }
                                },
                                x: {
                                    grid: { color: 'rgba(156, 163, 175, 0.1)' },
                                    ticks: { color: '#9ca3af' }
                                }
                            }
                        }
                    });

                    // Productivity Chart
                    if (this.charts.productivity) this.charts.productivity.destroy();
                    this.charts.productivity = new Chart(document.getElementById('productivityChart'), {
                        type: 'bar',
                        data: {
                            labels: productivity.map(p => aiApp.formatDate(p.date)).reverse().slice(-7),
                            datasets: [
                                {
                                    label: 'üìã Planned',
                                    data: productivity.map(p => p.tasks_planned).reverse().slice(-7),
                                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                    borderColor: '#3b82f6',
                                    borderWidth: 2
                                },
                                {
                                    label: '‚úÖ Completed',
                                    data: productivity.map(p => p.tasks_completed).reverse().slice(-7),
                                    backgroundColor: 'rgba(16, 185, 129, 0.6)',
                                    borderColor: '#10b981',
                                    borderWidth: 2
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    labels: { color: '#fff', font: { size: 12, weight: 'bold' } }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'rgba(59, 130, 246, 0.1)' },
                                    ticks: { color: '#3b82f6' }
                                },
                                x: {
                                    grid: { color: 'rgba(156, 163, 175, 0.1)' },
                                    ticks: { color: '#9ca3af' }
                                }
                            }
                        }
                    });

                    // Mood Chart
                    if (this.charts.mood) this.charts.mood.destroy();
                    this.charts.mood = new Chart(document.getElementById('moodChart'), {
                        type: 'line',
                        data: {
                            labels: mood.map(m => aiApp.formatDate(m.timestamp)).reverse().slice(-7),
                            datasets: [
                                {
                                    label: 'üòä Happiness',
                                    data: mood.map(m => m.happiness_level).reverse().slice(-7),
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true
                                },
                                {
                                    label: 'üò∞ Stress',
                                    data: mood.map(m => m.stress_level).reverse().slice(-7),
                                    borderColor: '#ef4444',
                                    backgroundColor: 'rgba(239, 68, 68, 0.2)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    labels: { color: '#fff', font: { size: 12, weight: 'bold' } }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 10,
                                    grid: { color: 'rgba(236, 72, 153, 0.1)' },
                                    ticks: { color: '#ec4899' }
                                },
                                x: {
                                    grid: { color: 'rgba(156, 163, 175, 0.1)' },
                                    ticks: { color: '#9ca3af' }
                                }
                            }
                        }
                    });

                    // Habits Doughnut Chart
                    const avgHabits = {
                        reading: habits.length > 0 ? aiApp.calculateAverage(habits, 'reading_minutes') : 0,
                        meditation: habits.length > 0 ? aiApp.calculateAverage(habits, 'meditation_minutes') : 0,
                        socialMedia: habits.length > 0 ? aiApp.calculateAverage(habits, 'social_media_minutes') : 0
                    };

                    if (this.charts.habits) this.charts.habits.destroy();
                    this.charts.habits = new Chart(document.getElementById('habitsChart'), {
                        type: 'doughnut',
                        data: {
                            labels: ['üìö Reading', 'üßò Meditation', 'üì± Social Media'],
                            datasets: [{
                                data: [avgHabits.reading, avgHabits.meditation, avgHabits.socialMedia],
                                backgroundColor: [
                                    'rgba(139, 92, 246, 0.8)',
                                    'rgba(16, 185, 129, 0.8)',
                                    'rgba(245, 158, 11, 0.8)'
                                ],
                                borderColor: ['#8b5cf6', '#10b981', '#f59e0b'],
                                borderWidth: 3,
                                hoverOffset: 15
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: { color: '#fff', font: { size: 11, weight: 'bold' } }
                                }
                            }
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>